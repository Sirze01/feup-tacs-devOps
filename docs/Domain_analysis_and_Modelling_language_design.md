# DevOps Equalizer - Domain analysis and modelling language design

## Table of contents
1. [Domain analysis](#domain-analysis)
    1. [GitHub Actions](#github-actions)
    2. [GitLab Pipelines](#gitlab-pipelines)
    3. [CircleCI](#circleci)
    4. [Jenkins](#jenkins)
2. [Metamodel](#metamodel)
    1. [Classes](#classes)
    2. [OCL Constraints](#ocl-constraints)

## Domain analysis
To accurately model the domain of CI/CD pipelines, we choose to analyze popular systems and extract the concepts that are either common to all of them or interesting to integrate into CI/CD systems. We tried to incorporate only features supported directly by all the systems or that we knew we could replicate relatively easily.

The most popular CI/CD tools are those that are integrated into SCM systems. Apart from tools integrated into such systems, we also studied Jenkins and CircleCI, which is a standalone CI/CD system.

### GitHub Actions
GitHub Actions is a CI/CD system integrated into GitHub. It is a very popular system due to its ease of use and integration with GitHub.

[<div style="height:auto;"><img src="./resources/analysis-GHActions.png"></div>](./resources/analysis-GHActions.png)

Although GitHub Actions workflows are primarily meant to be triggered via GitHub repository events, they can also be triggered via webhooks. Another essential feature is the community typically encapsulates that reusable workflow pieces in the so-called GitHub Actions, which can be used inside a workflow. These actions are usually written in JavaScript or Dockerfiles.


### GitLab Pipelines
Popular in enterprise environments, GitLab Pipelines is a CI/CD system integrated into GitLab. It focuses more on self-hosted runners and is more complex than GitHub Actions. We plotted the most essential concepts in the following diagram.

[<div style="height:auto;"><img src="./resources/analysis-GitLabPipelines.png"></div>](./resources/analysis-GitLabPipelines.png)

We found the concept of "stages" interesting as a basic unit of task parallelization. We also found the concept of "rules" interesting as a way to execute tasks conditionally. These can be emulated in GitHub Actions using the `needs` and `if` keywords in GitHub Actions workflows.

### CircleCI

CircleCI is an independent, very cloud-focused CI/CD system. It is prevalent in the open-source community due to its ease of use, integration with external SCM services, and friendly free tier.

CircleCI has a single pipeline model and uses "orbs" as a unit of reusability. Orbs are similar to GitHub Actions in that they are reusable pieces of code that can be used in a pipeline. They are written in YAML and can be used in any pipeline. They are usually used to encapsulate common tasks such as building, testing, and deploying.

[<div style="height:auto;"><img src="./resources/analysis-CircleCI.png"></div>](./resources/analysis-CircleCI.png)


### Jenkins

Being a standalone tool, Jenkins is highly flexible and extensible at the cost of more complex configuration and conceptual complexity.

[<div style="height:auto;"><img src="./resources/analysis-Jenkins.png"></div>](./resources/analysis-Jenkins.png)

## Metamodel

Based on the analysis of the systems above, we came up with a set of model classes. Our system should be able to model most of the common concepts and compile them to the different systems' configuration files in the future, effectively allowing users to use the same pipelines in different systems with little to no changes.

### Classes

| Concept           | Description                                                                                                                               |
| ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| Trigger           | Metadata about the event that triggered the pipeline run                                                                                  |
| RepositoryEvent   | Metadata of events in a Git-based SCM system                                                                                              |
| Push              | Metadata about pushes made on a Git-based SCM system.                                                                                     |
| MergeRequest      | Metadata about merge request creation or updates on the branch it uses as source on a Git-based SCM system.                               |
| WebHook           | Metadata about the event triggering the pipeline. Event generated by an external entity making a request to the system webhooks endpoint. |
| APITrigger        | Metadata about a manually triggered pipeline run. May be triggered by the user, or other system components.                               |
| CronTrigger       | Metadata of a sheduled pipeline run, using intervals.                                                                                     |
| Runner            | Metadata about the execution environment where tasks will be performed                                                                    |
| SelfHostedRunner  | Runner managed by the user on their own infrastructure, such as on their own servers or virtual machines                                  |
| SSHRunner         | Runner provided by CI/CD platform to perform tasks                                                                                        |
| IaaS              | Infrastructure as a service (cloud) runners.                                                                                              |
| OperatingSystem   | A (virtual) machine with an operating system with resources directly exposed.                                                             |
| ContainerEngine   | Metadata for the container environment.                                                                                                   |
| Environment       | Variables available as both input and output of a pipeline or task.                                                                       |
| Pipeline          | The highest level unit of the CI/CD system. It is trigerred by an event and is composed of several sequential stages.                     |
| Stage             | A set of tasks that can run in parallel.                                                                                                  |
| Task              | Unit composed of sequential explicit steps and/or invoking other tasks.                                                                   |
| Step              | A computational unit, usually a shell script.                                                                                             |
| Conditional       | A boolean operation that may guard the execution of other CI/CD units.                                                                    |
| UnaryConditional  | A conditional with one operand.                                                                                                           |
| BinaryConditional | A conditional with two operands.                                                                                                          |
| Operand           | The evaluation of an environment variable or a conditional.                                                                               |
| LogicOperator     | A logic operator, such as NOT, AND or OR, to be used in conditionals.                                                                     |

### OCL Constraints

Besides the cardinality constraints defined in the UML, we defined the following OCL constraints to enrich the metamodel:

1. Pipeline: *UniqueName* - A pipeline's name must be unique. This is because pipelines are usually referenced by name in other parts of the system, such as in the configuration files of the SCM system. The name may also serve as an identifier for the generated webhooks.

2. Pipeline: *UniqueTaskNames* - Tasks inside a pipeline must have unique names. 

3. CronTrigger: *PositiveDuration* - The duration of a cron trigger must be positive, which means either hours, minutes, or seconds must be greater than zero.
